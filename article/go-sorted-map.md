# Go有序map实现思路

首先，所谓有序map指的是遍历的时候可以按照key大小顺序
或者插入顺序进行遍历，至于内部存储是不是按序存储并不重要。
先明确这一点，再来看下面的思路。

## 按key大小顺序遍历map

首先，可以用红黑树来实现，
这样在存储的时候就是有序的，
遍历的时候进行中序遍历就可以了。

或者get、set、delete就像平时一样操作map，
遍历的时候先取出所有key，放到一个slice中，
排序后再按序从map中取值。
如果要做到并发安全，可以将map替换成sync.Map，
使用sync.Map的遍历方法取出所有key，
排序后按序取值，因为是并发的，所以
取值的时候，可能key已经不存在了，
这时候跳过这个key就可以了。

## 按插入顺序遍历map

其实思路跟按key有序遍历是一样的，
只不过需要多记录一个单调递增的编号，
在新key插入的时候设置这个编号，
后面更新的时候只更新值，不更新编号。
遍历的时候先按编号排序，然后按序取值就可以了。

如果是并发环境下，就把map换成sync.Map。
因为是并发环境，所以编号递增的时候要使用
atomic.AddXXX进行原子操作。
